#include <math.h>
#include "rk78.h"

#define COPY(A,B) for(i=0; i<n;i++) B[i]=A[i];

int flux (
double *t, double x[], double *h, double T,
double pasmin, double pasmax, double tol, int npasmx,
int n,
int (*camp)(int n, double t, double x[], double f[], void *prm),
void *prm
){ 
  
  double ox[n];
  double h=h,ot=0, t0;
  int i;
  
 
  do{
    if(t > T + t0 - 1.1*pasmax){
      ot=t;
      COPY(x, ox);
    }
    rk78(&t,z,&h,pasmin, pasmax,tol,n,camp,prm);
  }
  while(t<T+t0)
  
  t=ot;
  COPY(ox,x);
  h=T+t0-t;
  rk78(t, x,&h, h, h, 100, n, camp, prm)
    
  
}